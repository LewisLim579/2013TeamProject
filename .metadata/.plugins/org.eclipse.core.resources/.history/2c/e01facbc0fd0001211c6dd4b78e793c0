package com.example.ptsapp;


import android.app.Activity;
import android.app.AlertDialog;
import android.content.DialogInterface;
import android.content.Intent;
import android.database.Cursor;
import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.widget.AdapterView;
import android.widget.CursorAdapter;
import android.widget.EditText;
import android.widget.ListView;
import android.widget.SimpleCursorAdapter;
import android.widget.TextView;
public class Ex07_06Activity extends Activity {
    
	
	ListView listView;
	MySQLiteHandler handler;
	 Cursor c;
	 SimpleCursorAdapter adapter;
	 
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        
        listView = (ListView)findViewById(R.id.listView1);
        
        handler = MySQLiteHandler.open(getApplicationContext());
        
        c = handler.selectAll();
        startManagingCursor(c);
        adapter =
        		 new SimpleCursorAdapter(
        				 getApplicationContext(),
        				 R.layout.list_row,
        				 c,
        				 new String[]{"_id","name","age","address"},
        				 new int[]{ R.id.txtId, R.id.txtName, R.id.txtAge, R.id.txtAddress },
        				 CursorAdapter.FLAG_REGISTER_CONTENT_OBSERVER);
        
        listView.setAdapter(adapter);
        
        
        // 학생정보 자세히 보기 
       listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {

		@Override
		public void onItemClick(AdapterView<?> parent, View v, int position,
				long id) {
			TextView tv = (TextView)v.findViewById(R.id.txtId);
			
			Intent intent = new Intent(getApplicationContext(), DetailActivity.class);
			intent.putExtra("_id", tv.getText().toString());
			startActivity(intent);
			
		}
	   });

    }

	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
	
		   MenuInflater inflater = getMenuInflater();
           inflater.inflate(R.menu.mymenu, menu); 
           return true;
	}

	@Override
	public boolean onOptionsItemSelected(MenuItem item) {
		
   switch( item.getItemId() ){
		
		case R.id.addMenu:
			
			LayoutInflater inf = getLayoutInflater();
			View convertView = inf.inflate(R.layout.studentadd, null);
			
		final	EditText  editName = (EditText)convertView.findViewById(R.id.editName);
		final	EditText editAddress = (EditText)convertView.findViewById(R.id.editAddress);
		final	EditText editAge = (EditText)convertView.findViewById(R.id.editAge);
			
			AlertDialog.Builder builder = new AlertDialog.Builder(Ex07_06Activity.this);
			builder.setTitle("학생 등록");
			builder.setIcon(android.R.drawable.stat_sys_warning);
			builder.setView(convertView);
			builder.setPositiveButton("확인",  new DialogInterface.OnClickListener() {
				
				@Override
				public void onClick(DialogInterface dialog, int which) {

					String name = editName.getText().toString();
					String address = editAddress.getText().toString();
					String age =editAge.getText().toString();
					
					handler.insert(name,  Integer.parseInt(age) ,address );
					
					//추가 내용 다시 가져오기
					c.requery();
					adapter.notifyDataSetChanged();
					
				}
			});
			builder.setNegativeButton("취소",  null);
			builder.show();
			
			break;
			
		case R.id.loginMenu:
			
		case R.id.preferMenu:
		
		}//end 
	   return super.onOptionsItemSelected(item);
	}
    
    
    
    
    
}